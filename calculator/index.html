<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>金融计算器 - Ploutos Finance</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/lodash@4.17.21/lodash.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    // 这里粘贴您的React组件代码
    const { useState } = React;
    
    // 粘贴您之前分享的FinancialModel代码...
    const App = () => {
      // 财务模型应用
      const FinancialModel = () => {
        // 状态管理
        const [activeTab, setActiveTab] = useState(0);
        const [parameters, setParameters] = useState({
          // 时间参数
          startQuarter: "2025 Q2",
          forecastPeriod: "5年",
          // 初始资金
          initialFunding: 2000000,
          // 融资计划
          financing: [
            { quarter: "2025Q2", amount: 0, note: "天使轮已完成" },
            { quarter: "2026Q1", amount: 2000000, note: "A轮融资" },
            { quarter: "2027Q2", amount: 5000000, note: "B轮融资" },
            { quarter: "2028Q3", amount: 0, note: "暂无计划" },
            { quarter: "2029Q4", amount: 0, note: "暂无计划" }
          ],
          // AUM增长预测
          aumGrowth: [
            { period: "2025年Q2", aum: 2000000, growthRate: 0 },
            { period: "2025年Q3-Q4", aum: 5000000, growthRate: 1.5 },
            { period: "2026年", aum: 25000000, growthRate: 4 },
            { period: "2027年", aum: 100000000, growthRate: 3 },
            { period: "2028年", aum: 250000000, growthRate: 1.5 },
            { period: "2029年", aum: 500000000, growthRate: 1 },
            { period: "2030年Q1", aum: 575000000, growthRate: 0.15 }
          ],
          // 收入参数
          tokenizationFee: 0.015,
          // 通证化费率
          managementFee: 0.01,
          // 年管理费率
          transactionFee: 0.002,
          // 交易费率
          transactionVolume: 0.5,
          // 年交易量占AUM比例
          lendingServiceFee: 0.003,
          // 借贷服务费率
          lendingSpread: 0.02,
          // 借贷利差
          // 借贷规模占AUM比例
          lendingRatio: [
            { year: 2025, ratio: 0, note: "业务尚未启动" },
            { year: 2026, ratio: 0.2, note: "业务初步启动" },
            { year: 2027, ratio: 0.3, note: "业务稳步增长" },
            { year: 2028, ratio: 0.35, note: "业务成熟发展" },
            { year: 2029, ratio: 0.4, note: "业务全面深化" },
            { year: 2030, ratio: 0.4, note: "业务持续优化" }
          ],
          // 成本类别
          costCategories: [
            { id: "tech", name: "技术开发成本", isActive: true },
            { id: "marketing", name: "营销与销售成本", isActive: true },
            { id: "legal", name: "法律与合规成本", isActive: true },
            { id: "operation", name: "运营成本", isActive: true },
            { id: "custom1", name: "自定义成本1", isActive: false },
            { id: "custom2", name: "自定义成本2", isActive: false },
            { id: "custom3", name: "自定义成本3", isActive: false }
          ],
          // 成本参数 - 团队成本（每季度）
          teamCost: [
            { period: "2025年Q2", cost: 150000 },
            { period: "2025年Q3-Q4", cost: 175000 },
            { period: "2026年", cost: 200000 },
            { period: "2027年", cost: 375000 },
            { period: "2028年", cost: 625000 },
            { period: "2029年", cost: 875000 },
            { period: "2030年Q1", cost: 900000 }
          ],
          // 自定义成本
          custom1Cost: [
            { period: "2025年Q2", cost: 0 },
            { period: "2025年Q3-Q4", cost: 0 },
            { period: "2026年", cost: 0 },
            { period: "2027年", cost: 0 },
            { period: "2028年", cost: 0 },
            { period: "2029年", cost: 0 },
            { period: "2030年Q1", cost: 0 }
          ],
          custom2Cost: [
            { period: "2025年Q2", cost: 0 },
            { period: "2025年Q3-Q4", cost: 0 },
            { period: "2026年", cost: 0 },
            { period: "2027年", cost: 0 },
            { period: "2028年", cost: 0 },
            { period: "2029年", cost: 0 },
            { period: "2030年Q1", cost: 0 }
          ],
          // 技术开发成本（每季度）
          techCost: [
            { period: "2025年Q2", cost: 200000 },
            { period: "2025年Q3-Q4", cost: 100000 },
            { period: "2026年", cost: 150000 },
            { period: "2027年", cost: 200000 },
            { period: "2028年", cost: 300000 },
            { period: "2029年", cost: 400000 },
            { period: "2030年Q1", cost: 400000 }
          ],
          // 营销与销售成本（每季度）
          marketingCost: [
            { period: "2025年Q2", cost: 75000 },
            { period: "2025年Q3-Q4", cost: 100000 },
            { period: "2026年", cost: 125000 },
            { period: "2027年", cost: 175000 },
            { period: "2028年", cost: 250000 },
            { period: "2029年", cost: 325000 },
            { period: "2030年Q1", cost: 350000 }
          ],
          // 法律与合规成本（每季度）
          legalCost: [
            { period: "2025年Q2", cost: 75000 },
            { period: "2025年Q3-Q4", cost: 75000 },
            { period: "2026年", cost: 100000 },
            { period: "2027年", cost: 150000 },
            { period: "2028年", cost: 200000 },
            { period: "2029年", cost: 250000 },
            { period: "2030年Q1", cost: 275000 }
          ],
          // 运营成本（每季度）
          operationCost: [
            { period: "2025年Q2", cost: 50000 },
            { period: "2025年Q3-Q4", cost: 50000 },
            { period: "2026年", cost: 75000 },
            { period: "2027年", cost: 100000 },
            { period: "2028年", cost: 125000 },
            { period: "2029年", cost: 175000 },
            { period: "2030年Q1", cost: 200000 }
          ],
          // 折旧摊销
          depreciation: [
            { period: "2025年Q2", value: 40000 },
            { period: "2025年Q3-Q4", value: 30000 },
            { period: "2026年", value: 30000 },
            { period: "2027年", value: 40000 },
            { period: "2028年", value: 60000 },
            { period: "2029年", value: 80000 },
            { period: "2030年Q1", value: 85000 }
          ],
          // 税率
          taxRate: 0.25
        });

        // 这里是您的FinancialModel其余代码...
        // 包括generateQuarters, getAumGrowth, calculateAumForecast等函数...
        
        // 生成季度序列（2025年Q2至2030年Q1）
        const generateQuarters = () => {
          const quarters = [];
          const years = [2025, 2026, 2027, 2028, 2029, 2030];
          
          for (const year of years) {
            if (year === 2025) {
              quarters.push(`${year}Q2`);
              quarters.push(`${year}Q3`);
              quarters.push(`${year}Q4`);
            } else if (year === 2030) {
              quarters.push(`${year}Q1`);
            } else {
              quarters.push(`${year}Q1`);
              quarters.push(`${year}Q2`);
              quarters.push(`${year}Q3`);
              quarters.push(`${year}Q4`);
            }
          }
          
          return quarters;
        };

        // 返回指定季度的AUM增长值
        const getAumGrowth = (quarter) => {
          const year = parseInt(quarter.substring(0, 4));
          const q = quarter.substring(4, 6);
          
          // 2025Q2是初始AUM
          if (quarter === "2025Q2") {
            return parameters.aumGrowth[0].aum;
          }
          
          // 2025年Q3-Q4
          if ((year === 2025) && (q === "Q3" || q === "Q4")) {
            const growthRate = parameters.aumGrowth[1].growthRate;
            return parameters.aumGrowth[0].aum * growthRate / 2;
          }
          
          // 2026-2029年各季度
          if (year >= 2026 && year <= 2029) {
            const yearIndex = year - 2025 + 1;
            
            // 对应parameters.aumGrowth中的索引
            const previousYearTarget = parameters.aumGrowth[yearIndex - 1].aum;
            const currentYearTarget = parameters.aumGrowth[yearIndex].aum;
            const yearlyGrowth = currentYearTarget - previousYearTarget;
            
            // 平均分配到4个季度
            return yearlyGrowth / 4;
          }
          
          // 2030年Q1
          if (year === 2030 && q === "Q1") {
            const previousYearAum = parameters.aumGrowth[5].aum;
            const targetAum = parameters.aumGrowth[6].aum;
            return targetAum - previousYearAum;
          }
          
          // 默认返回0
          return 0;
        };

        // 计算AUM预测
        const calculateAumForecast = () => {
          const quarters = generateQuarters();
          const forecast = [];
          
          for (let i = 0; i < quarters.length; i++) {
            const quarter = quarters[i];
            const growthAmount = getAumGrowth(quarter);
            let beginningAum = 0;
            
            if (i === 0) {
              beginningAum = 0; // 2025Q2从0开始
            } else {
              beginningAum = forecast[i - 1].endingAum;
            }
            
            const endingAum = beginningAum + growthAmount;
            const averageAum = (beginningAum + endingAum) / 2;
            
            forecast.push({ quarter, beginningAum, growthAmount, endingAum, averageAum });
          }
          
          return forecast;
        };

        // 获取指定成本类别的季度成本
        const getActiveCostCategories = () => {
          return parameters.costCategories.filter(category => category.isActive);
        };

        // 获取特定成本类别的数据序列
        const getCostDataForCategory = (categoryId) => {
          switch (categoryId) {
            case "tech":
              return parameters.techCost;
            case "marketing":
              return parameters.marketingCost;
            case "legal":
              return parameters.legalCost;
            case "operation":
              return parameters.operationCost;
            case "custom1":
              return parameters.custom1Cost;
            case "custom2":
              return parameters.custom2Cost;
            case "custom3":
              return parameters.custom3Cost;
            default:
              return [];
          }
        };

        // 根据期间和类别获取成本值
        const getCostForPeriodAndCategory = (period, categoryId) => {
          const costData = getCostDataForCategory(categoryId);
          const periodCost = costData.find(item => item.period === period);
          return periodCost ? periodCost.cost : 0;
        };

        // 计算特定季度的总成本
        const calculateTotalCostForQuarter = (quarter) => {
          // 将quarter (e.g., "2025Q2") 转换为 period格式 (e.g., "2025年Q2")
          const year = quarter.substring(0, 4);
          const q = quarter.substring(4);
          let period;
          
          if (year === "2025" && (q === "Q3" || q === "Q4")) {
            period = "2025年Q3-Q4";
          } else {
            period = `${year}年${q}`;
          }
          
          const activeCategories = getActiveCostCategories();
          let totalCost = 0;
          
          activeCategories.forEach(category => {
            totalCost += getCostForPeriodAndCategory(period, category.id);
          });
          
          return totalCost;
        };

        // 计算特定季度的折旧摊销
        const getDepreciationForQuarter = (quarter) => {
          // 将quarter转换为period格式
          const year = quarter.substring(0, 4);
          const q = quarter.substring(4);
          let period;
          
          if (year === "2025" && (q === "Q3" || q === "Q4")) {
            period = "2025年Q3-Q4";
          } else {
            period = `${year}年${q}`;
          }
          
          const depreciation = parameters.depreciation.find(item => item.period === period);
          return depreciation ? depreciation.value : 0;
        };

        // 计算特定年份的借贷比率
        const getLendingRatioForYear = (year) => {
          const yearRatio = parameters.lendingRatio.find(item => item.year === parseInt(year));
          return yearRatio ? yearRatio.ratio : 0;
        };

        // 计算财务预测
        const calculateFinancialForecast = () => {
          const forecast = [];
          const aumForecast = calculateAumForecast();
          
          // 初始现金 = 初始资金
          let remainingCash = parameters.initialFunding;
          
          for (let i = 0; i < aumForecast.length; i++) {
            const quarterData = aumForecast[i];
            const quarter = quarterData.quarter;
            const year = quarter.substring(0, 4);
            
            // 检查该季度是否有融资
            const financing = parameters.financing.find(f => f.quarter === quarter);
            const financingAmount = financing ? financing.amount : 0;
            
            // 增加融资金额
            remainingCash += financingAmount;
            
            // 计算收入
            // 1. 通证化费收入 = 新增AUM * 通证化费率
            const tokenizationIncome = quarterData.growthAmount * parameters.tokenizationFee;
            
            // 2. 管理费收入 = 平均AUM * 管理费率 / 4 (季度)
            const managementIncome = quarterData.averageAum * parameters.managementFee / 4;
            
            // 3. 交易费收入 = 平均AUM * 交易量比例 * 交易费率 / 4 (季度)
            const transactionIncome = quarterData.averageAum * parameters.transactionVolume * parameters.transactionFee / 4;
            
            // 4. 借贷收入 = 平均AUM * 借贷比例 * (借贷服务费 + 借贷利差) / 4 (季度)
            const lendingRatio = getLendingRatioForYear(year);
            const lendingIncome = quarterData.averageAum * lendingRatio * (parameters.lendingServiceFee + parameters.lendingSpread) / 4;
            
            // 总收入
            const totalIncome = tokenizationIncome + managementIncome + transactionIncome + lendingIncome;
            
            // 计算成本
            const totalCost = calculateTotalCostForQuarter(quarter);
            const depreciation = getDepreciationForQuarter(quarter);
            
            // 息税前利润 (EBIT)
            const ebit = totalIncome - totalCost - depreciation;
            
            // 所得税
            const tax = ebit > 0 ? ebit * parameters.taxRate : 0;
            
            // 净利润
            const netIncome = ebit - tax;
            
            // 自由现金流 = 净利润 + 折旧 - 资本支出
            // 简化假设：资本支出 = 折旧
            const freeCashFlow = netIncome;
            
            // 更新剩余现金
            remainingCash += freeCashFlow;
            
            // 添加到预测结果
            forecast.push({
              quarter,
              averageAum: quarterData.averageAum,
              tokenizationIncome,
              managementIncome,
              transactionIncome,
              lendingIncome,
              totalIncome,
              totalCost,
              depreciation,
              ebit,
              tax,
              netIncome,
              freeCashFlow,
              remainingCash,
              financingAmount
            });
          }
          
          return forecast;
        };

        // 格式化数字为金额显示
        const formatNumber = (num) => {
          if (num === 0) return "-";
          
          if (Math.abs(num) >= 1000000) {
            return (num / 1000000).toFixed(2) + "M";
          } else if (Math.abs(num) >= 1000) {
            return (num / 1000).toFixed(2) + "K";
          } else {
            return num.toFixed(2);
          }
        };

        // 渲染财务预测表格
        const renderFinancialForecast = () => {
          const forecast = calculateFinancialForecast();
          
          return (
            <div className="overflow-x-auto">
              <table className="min-w-full bg-white border border-gray-300">
                <thead>
                  <tr className="bg-gray-100">
                    <th className="sticky left-0 bg-gray-100 px-4 py-2 border">季度</th>
                    <th className="px-4 py-2 border">平均AUM</th>
                    <th className="px-4 py-2 border">通证化收入</th>
                    <th className="px-4 py-2 border">管理费收入</th>
                    <th className="px-4 py-2 border">交易费收入</th>
                    <th className="px-4 py-2 border">借贷收入</th>
                    <th className="px-4 py-2 border">总收入</th>
                    <th className="px-4 py-2 border">总成本</th>
                    <th className="px-4 py-2 border">折旧摊销</th>
                    <th className="px-4 py-2 border">EBIT</th>
                    <th className="px-4 py-2 border">税</th>
                    <th className="px-4 py-2 border">净利润</th>
                    <th className="px-4 py-2 border">现金流</th>
                    <th className="px-4 py-2 border">融资</th>
                    <th className="px-4 py-2 border">剩余现金</th>
                  </tr>
                </thead>
                <tbody>
                  {forecast.map((item, index) => (
                    <tr key={index} className={index % 2 === 0 ? "bg-gray-50" : ""}>
                      <td className="sticky left-0 bg-white px-4 py-2 border font-medium">{item.quarter}</td>
                      <td className="px-4 py-2 border text-right">{formatNumber(item.averageAum)}</td>
                      <td className="px-4 py-2 border text-right">{formatNumber(item.tokenizationIncome)}</td>
                      <td className="px-4 py-2 border text-right">{formatNumber(item.managementIncome)}</td>
                      <td className="px-4 py-2 border text-right">{formatNumber(item.transactionIncome)}</td>
                      <td className="px-4 py-2 border text-right">{formatNumber(item.lendingIncome)}</td>
                      <td className="px-4 py-2 border text-right font-medium">{formatNumber(item.totalIncome)}</td>
                      <td className="px-4 py-2 border text-right">{formatNumber(item.totalCost)}</td>
                      <td className="px-4 py-2 border text-right">{formatNumber(item.depreciation)}</td>
                      <td className="px-4 py-2 border text-right">{formatNumber(item.ebit)}</td>
                      <td className="px-4 py-2 border text-right">{formatNumber(item.tax)}</td>
                      <td className="px-4 py-2 border text-right font-medium">{formatNumber(item.netIncome)}</td>
                      <td className="px-4 py-2 border text-right">{formatNumber(item.freeCashFlow)}</td>
                      <td className="px-4 py-2 border text-right">{formatNumber(item.financingAmount)}</td>
                      <td className="px-4 py-2 border text-right font-medium">{formatNumber(item.remainingCash)}</td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          );
        };

        // 主要渲染函数
        return (
          <div className="container mx-auto p-4">
            <h1 className="text-2xl font-bold mb-4">金融科技创业公司财务预测模型</h1>
            
            <div className="mb-6">
              <div className="flex border-b border-gray-200">
                <button 
                  className={`py-2 px-4 ${activeTab === 0 ? "border-b-2 border-blue-500 text-blue-500" : "text-gray-600"}`}
                  onClick={() => setActiveTab(0)}
                >
                  财务预测
                </button>
                <button 
                  className={`py-2 px-4 ${activeTab === 1 ? "border-b-2 border-blue-500 text-blue-500" : "text-gray-600"}`}
                  onClick={() => setActiveTab(1)}
                >
                  参数设置
                </button>
              </div>
              
              <div className="mt-4">
                {activeTab === 0 ? (
                  <div>
                    <h2 className="text-xl font-semibold mb-4">财务预测结果</h2>
                    {renderFinancialForecast()}
                  </div>
                ) : (
                  <div>
                    <h2 className="text-xl font-semibold mb-4">模型参数配置</h2>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                      <div className="bg-gray-50 p-4 rounded-lg">
                        <h3 className="font-medium mb-2">基本参数</h3>
                        <div className="mb-2">
                          <label className="block text-sm text-gray-600">开始季度</label>
                          <input 
                            type="text" 
                            value={parameters.startQuarter} 
                            className="w-full p-2 border rounded"
                            onChange={(e) => setParameters({...parameters, startQuarter: e.target.value})}
                          />
                        </div>
                        <div className="mb-2">
                          <label className="block text-sm text-gray-600">预测期间</label>
                          <input 
                            type="text" 
                            value={parameters.forecastPeriod} 
                            className="w-full p-2 border rounded"
                            onChange={(e) => setParameters({...parameters, forecastPeriod: e.target.value})}
                          />
                        </div>
                        <div className="mb-2">
                          <label className="block text-sm text-gray-600">初始资金</label>
                          <input 
                            type="number" 
                            value={parameters.initialFunding} 
                            className="w-full p-2 border rounded"
                            onChange={(e) => setParameters({...parameters, initialFunding: parseFloat(e.target.value)})}
                          />
                        </div>
                      </div>
                      
                      <div className="bg-gray-50 p-4 rounded-lg">
                        <h3 className="font-medium mb-2">收入参数</h3>
                        <div className="mb-2">
                          <label className="block text-sm text-gray-600">通证化费率</label>
                          <input 
                            type="number" 
                            value={parameters.tokenizationFee}
                            step="0.001" 
                            className="w-full p-2 border rounded"
                            onChange={(e) => setParameters({...parameters, tokenizationFee: parseFloat(e.target.value)})}
                          />
                        </div>
                        <div className="mb-2">
                          <label className="block text-sm text-gray-600">管理费率</label>
                          <input 
                            type="number" 
                            value={parameters.managementFee}
                            step="0.001" 
                            className="w-full p-2 border rounded"
                            onChange={(e) => setParameters({...parameters, managementFee: parseFloat(e.target.value)})}
                          />
                        </div>
                        <div className="mb-2">
                          <label className="block text-sm text-gray-600">交易费率</label>
                          <input 
                            type="number" 
                            value={parameters.transactionFee}
                            step="0.001" 
                            className="w-full p-2 border rounded"
                            onChange={(e) => setParameters({...parameters, transactionFee: parseFloat(e.target.value)})}
                          />
                        </div>
                        <div className="mb-2">
                          <label className="block text-sm text-gray-600">交易量比例</label>
                          <input 
                            type="number" 
                            value={parameters.transactionVolume}
                            step="0.1" 
                            className="w-full p-2 border rounded"
                            onChange={(e) => setParameters({...parameters, transactionVolume: parseFloat(e.target.value)})}
                          />
                        </div>
                      </div>
                    </div>
                    
                    <div className="mt-4 bg-gray-50 p-4 rounded-lg">
                      <h3 className="font-medium mb-2">AUM增长预测</h3>
                      <div className="overflow-x-auto">
                        <table className="min-w-full bg-white border border-gray-300">
                          <thead>
                            <tr className="bg-gray-100">
                              <th className="px-4 py-2 border">期间</th>
                              <th className="px-4 py-2 border">AUM目标</th>
                              <th className="px-4 py-2 border">增长率</th>
                            </tr>
                          </thead>
                          <tbody>
                            {parameters.aumGrowth.map((item, index) => (
                              <tr key={index}>
                                <td className="px-4 py-2 border">{item.period}</td>
                                <td className="px-4 py-2 border">
                                  <input 
                                    type="number" 
                                    value={item.aum} 
                                    className="w-full p-1 border rounded"
                                    onChange={(e) => {
                                      const newAumGrowth = [...parameters.aumGrowth];
                                      newAumGrowth[index].aum = parseFloat(e.target.value);
                                      setParameters({...parameters, aumGrowth: newAumGrowth});
                                    }}
                                  />
                                </td>
                                <td className="px-4 py-2 border">
                                  <input 
                                    type="number" 
                                    value={item.growthRate}
                                    step="0.1" 
                                    className="w-full p-1 border rounded"
                                    onChange={(e) => {
                                      const newAumGrowth = [...parameters.aumGrowth];
                                      newAumGrowth[index].growthRate = parseFloat(e.target.value);
                                      setParameters({...parameters, aumGrowth: newAumGrowth});
                                    }}
                                  />
                                </td>
                              </tr>
                            ))}
                          </tbody>
                        </table>
                      </div>
                    </div>
                    
                    {/* 这里可以添加更多成本配置界面的代码 */}
                  </div>
                )}
              </div>
            </div>
          </div>
        );
      };

      return (
        <div className="min-h-screen bg-gray-100">
          <FinancialModel />
        </div>
      );
    };

    // 渲染应用
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(
      <React.StrictMode>
        <App />
      </React.StrictMode>
    );
  </script>
</body>
</html>
